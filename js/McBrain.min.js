define("prematureOptimization",[],function(){function n(e,t){var n=e-1;while(n%4!==t)n+=13;return n}function r(e,t){if(!e.length)return;var n=e.indexOf(t);if(n===-1)return;e[n]=e[e.length-1],e.pop()}var e=[];for(var t=0;t<52;t++)e.push({num:t%13+1,suit:t%4});return{cardsInfo:e,infoToCardId:n,removeFromUnorderedArray:r}}),define("Simulator",["prematureOptimization"],function(e){var t=e.cardsInfo,n=e.infoToCardId,r=e.removeFromUnorderedArray,i=function(){this.curCards=[[],[],[],[]],this.curPlayers=[],this.curBoard=[],this.heartBroken=!1,this.curP=0,this.tmpVc=[]};return i.prototype.run=function(e,t,n,r,i,s,o){this.curCards.forEach(function(e,t){e.length=0,[].push.apply(e,r[t])}),this.curPlayers.length=0,[].push.apply(this.curPlayers,e),this.curBoard.length=0,[].push.apply(this.curBoard,t),this.heartBroken=n,this.curP=s,this.scores=o,this._play(s,i),this._rollout();var u=-1;return this.scores.forEach(function(e,t){e===26&&(u=t)}),u!==-1?u===this.curP?-26:26:this.scores[this.curP]},i.prototype._play=function(e,n){this.curPlayers.push(e),this.curBoard.push(n),t[n].suit===1&&(this.heartBroken=!0),r(this.curCards[e],n)},i.prototype._getValidCards=function(e){this.tmpVc.length=0;var n=this.tmpVc;if(this.curBoard.length===0)this.heartBroken?[].push.apply(this.tmpVc,e):e.forEach(function(e){t[e].suit!==1&&n.push(e)});else{var r=t[this.curBoard[0]].suit;e.forEach(function(e){t[e].suit===r&&n.push(e)})}return n.length||[].push.apply(n,e),this.tmpVc},i.prototype._rollout=function(){var e=this.curP;e++,e%=4;while(this.curBoard.length<4)this._play(e,this._othersDecide(this.curCards[e])),e++,e%=4;this._endRound();while(this.curCards[this.nextFirst].length){e=this.nextFirst;while(this.curBoard.length<4)e===this.curP?this._play(e,this._iDecide(this.curCards[e])):this._play(e,this._othersDecide(this.curCards[e])),e++,e%=4;this._endRound()}},i.prototype._endRound=function(){var e=this.curCards[0].length;for(var n=1;n<4;n++)if(e!=this.curCards[n].length)throw console.log(this.curCards),"what!";var r=t[this.curBoard[0]].suit,i=0,s=t[this.curBoard[0]].num,n,o=0;for(n=0;n<4;n++){var u=t[this.curBoard[n]];u.suit===r&&u.num>s&&(s=u.num,i=n),u.suit===1&&(o+=1),u.suit===0&&u.num===11&&(o+=13)}this.scores[this.curPlayers[i]]+=o,this.nextFirst=this.curPlayers[i],this.curBoard.length=0,this.curPlayers.length=0},i.prototype._othersDecide=function(e){var n=this._getValidCards(e),r=n.length,i=-1,s=-1,o=this.curBoard;return o.length?(i=t[o[0]].suit,s=o.reduce(function(e,n){var r=t[n];return r.suit===i&&r.num>e?r.num:e},0),n.reduce(function(e,n){var r=t[n],u=t[e];return u.suit===r.suit?r.suit===i?r.num<s?u.num>s||u.num<r.num?n:e:r.num>s&&u.num>s&&o.length===3?r.num>u.num?n:e:r.num<u.num?n:e:r.num>u.num?n:e:r.suit===0&&r.num===11?n:u.suit===0&&u.num===11?e:r.suit===1?n:u.suit===1?e:r.num>u.num?n:e})):n.reduce(function(e,n){return t[e].num>t[n].num?n:e})},i.prototype._iDecide=i.prototype._othersDecide,i}),define("Brain",[],function(){var e=function(e){this.user=e,this.playerInfo=[[],[],[],[]]};return e.prototype.watch=function(e){},e}),define("McBrain",["Simulator","Brain","prematureOptimization"],function(e,t,n){var r=n.cardsInfo,i=n.removeFromUnorderedArray,s=function(n){t.call(this,n),this.samplePlayers=[[],[],[],[]],this.tmpSample=[[],[],[],[]],this.heartBroken=!1,this.playersInfo=[{hasCard:[],lackCard:{},numCards:13,score:0},{hasCard:[],lackCard:{},numCards:13,score:0},{hasCard:[],lackCard:{},numCards:13,score:0},{hasCard:[],lackCard:{},numCards:13,score:0}],this.remainingCards=[];for(var i=0;i<52;i++)this.remainingCards.push(i);this.cardLackCount=r.map(function(){return 0}),this.simulator=new e};return s.prototype=Object.create(t.prototype),s.prototype.removeRemainingCard=function(e){i(this.remainingCards,e),this.playersInfo.forEach(function(t){i(t.hasCard,e)})},s.prototype.markLackCard=function(e,t){t.lackCard[e]||(t.lackCard[e]=!0,this.cardLackCount[e]++)},s.prototype.watch=function(e){if(e.type==="in")e.cards.forEach(function(e){this.removeRemainingCard(e.id)}.bind(this)),[].push.apply(this.playersInfo[e.player.id].hasCard,e.cards.map(function(e){return e.id}));else{this.playersInfo[e.player.id].numCards--,this.removeRemainingCard(e.card.id),e.card.suit===1&&(this.heartBroken=!0);var t=this.markLackCard.bind(this),n=this.playersInfo[e.player.id];e.curSuit!==e.card.suit&&this.remainingCards.forEach(function(i){r[i].suit===e.curSuit&&t(i,n)})}},s.prototype.decide=function(e,t,n,r){this.knowSelf||(this.user.row.cards.forEach(function(e){this.removeRemainingCard(e.id),this.samplePlayers[this.user.id].push(e.id)}.bind(this)),this.knowSelf=!0);var s;if(e.length===1)s=e[0];else{var o=0,u=n.map(function(e){return e.id}),a=t.map(function(e){return e.id}),f=Date.now()+1e3,l=e.map(function(e){return 0}),c;this.preGenSample();while(Date.now()<f){o++,this.genSample();for(c=0;c<e.length;c++)l[c]+=this.simulator.run(u,a,this.heartBroken,this.samplePlayers,e[c].id,this.user.id,[].concat(r))}var h=1/0,p;for(c=0;c<l.length;c++)h>l[c]&&(h=l[c],p=c);s=e[p]}return i(this.samplePlayers[this.user.id],s.id),$.Deferred().resolve(s.ind)},s.prototype.preGenSample=function(){var e=this.cardLackCount;this.remainingCards.sort(function(t,n){return e[n]-e[t]})},s.prototype.genSample=function(){var e=this.user.id,t=this.samplePlayers,n=this.playersInfo,r=1e6,s;while(r--){t.forEach(function(t,n){n!==e&&(t.length=0),t.id=n}),this.playersInfo.forEach(function(e,n){[].push.apply(t[n],e.hasCard)});var o=t.filter(function(e,t){return e.length<n[t].numCards});s=0;var u=0,a=0;o.forEach(function(e){u+=e.length,a+=n[e.id].numCards});while(s<this.remainingCards.length){var f=this.remainingCards[s],l=o.length,c=0;while(c<l)if(this.playersInfo[o[c].id].lackCard[f]){l--;var h=o[l];o[l]=o[c],o[c]=h}else c++;if(l===0)break;var p=Math.floor(Math.random()*l);o[p].push(f),s++;if(o[p].length===n[o[p].id].numCards){i(o,o[p]);if(o.length===0)break}}if(s===this.remainingCards.length)break}r===-1&&(console.log(this.remainingCards,this.playersInfo),alert("fail to gen sample"));if(t.some(function(e,t){return e.length!==n[t].numCards}))throw console.log(this.remainingCards.length,t,n,r),"eh"},s});